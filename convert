#!/bin/bash
# Inside `vagrant ssh`.

cd /var/www/presskit

php index.php > /pxn/presskit/index.html
php style.css > /pxn/presskit/style.css

# And here come the dirty hack to make presskit workâ€¦

# -------------------------------------------------------
# BulletML for Unity
# -------------------------------------------------------

export QUERY_STRING="p=bulletml_for_unity"
php -e -r 'parse_str($_SERVER["QUERY_STRING"], $_GET); include "sheet.php";' > /pxn/presskit/bulletml_for_unity.html

# -------------------------------------------------------
# Shmupfest.
# -------------------------------------------------------

export QUERY_STRING="p=shmupfest"
php -e -r 'parse_str($_SERVER["QUERY_STRING"], $_GET); include "sheet.php";' > /pxn/presskit/shmupfest.html

# -------------------------------------------------------
# Supermassive.
# -------------------------------------------------------

export QUERY_STRING="p=supermassive"
php -e -r 'parse_str($_SERVER["QUERY_STRING"], $_GET); include "sheet.php";' > /pxn/presskit/supermassive.html

# -------------------------------------------------------
# Fix links.
# -------------------------------------------------------

sed -e 's/sheet.php?p=bulletml_for_unity/bulletml_for_unity.html/g' \
    -e 's/sheet.php?p=shmupfest/shmupfest.html/g' \
    -e 's/sheet.php?p=supermassive/supermassive.html/g' \
    /pxn/presskit/index.html > /tmp/tmp.html

mv /tmp/tmp.html /pxn/presskit/index.html
